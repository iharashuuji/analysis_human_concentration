version: "3.8"

services:
  app:
    # Dockerfileを参照してビルド
    build: .
    
    ports:
      - "8501:8501"
      
    volumes:
      - .:/app
      - weights_data:/app/weights
      - ./data:/app/data

    # ★★★ GPUを使用するための設定 ★★★
    deploy:
      resources:
        reservations:
          devices:
            # NVIDIA GPUを指定
            - driver: nvidia
              count: all  # すべてのGPUを使用 (特定のGPU IDを指定することも可能)
              capabilities: [gpu] # GPU機能を有効化
    
    # コンテナ起動時にGPUが利用できることを保証する環境変数を設定（オプションだが推奨）
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all

# ボリュームの定義
volumes:
  weights_data:

